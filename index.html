<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cine Assistant</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>

<body class="bg-light d-flex flex-column" style="min-height:100vh;">

  <!-- Header -->
  <nav class="navbar bg-white border-bottom px-3">
    <span class="navbar-brand fw-semibold">
      üé¨ Cine Assistant
    </span>
    <span class="badge bg-secondary">Demo</span>
  </nav>

  <!-- Chat container -->
  <main class="container my-3 flex-grow-1 d-flex flex-column">
    <div id="chat" class="flex-grow-1 d-flex flex-column gap-2">
      <div class="align-self-start bg-white border rounded-4 p-3">
        üëã Hola. Eleg√≠ <b>Pel√≠cula</b> o <b>Actor</b> y escrib√≠ abajo.
      </div>
    </div>
  </main>

  <!-- Input area -->
  <footer class="bg-white border-top p-3">
    <div class="container">
      <div class="row g-2 align-items-center mb-2">
        <div class="col-12 col-md-3">
          <select id="mode" class="form-select">
            <option value="movie" selected>üé¨ Pel√≠cula</option>
            <option value="actor">üé≠ Actor</option>
          </select>
        </div>
        <div class="col-12 col-md-9">
          <small class="text-muted" id="hint">
            Escrib√≠ una pel√≠cula (ej: The Godfather)
          </small>
        </div>
      </div>

      <form id="form" class="row g-2">
        <div class="col-12 col-md-10">
          <input
            id="text"
            class="form-control form-control-lg"
            placeholder="Escrib√≠ ac√°..."
            autocomplete="off"
          />
        </div>
        <div class="col-12 col-md-2 d-grid">
          <button class="btn btn-primary btn-lg" type="submit">
            Enviar
          </button>
        </div>
      </form>

      <div class="small text-muted mt-2">
        Backend: <code id="backendUrl"></code>
      </div>
    </div>
  </footer>

  <script>
    // üëâ URL de tu backend en Render
    const BACKEND = "https://cine-app-otdv.onrender.com";

    const chat = document.getElementById("chat");
    const form = document.getElementById("form");
    const textInput = document.getElementById("text");
    const modeSelect = document.getElementById("mode");
    const hint = document.getElementById("hint");
    const backendUrl = document.getElementById("backendUrl");

    backendUrl.textContent = BACKEND;

    function addMessage(text, side = "left") {
      const div = document.createElement("div");
      div.className =
        side === "right"
          ? "align-self-end bg-primary text-white rounded-4 p-3"
          : "align-self-start bg-white border rounded-4 p-3";

      div.style.maxWidth = "80%";
      div.innerText = text;
      chat.appendChild(div);

      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    }

    modeSelect.addEventListener("change", () => {
      if (modeSelect.value === "movie") {
        hint.innerText = "Escrib√≠ una pel√≠cula (ej: The Godfather)";
      } else {
        hint.innerText = "Escrib√≠ un actor (ej: Leonardo DiCaprio)";
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const text = textInput.value.trim();
      if (!text) return;

      const mode = modeSelect.value;
      textInput.value = "";

      addMessage(text, "right");
      addMessage("‚è≥ Buscando...", "left");

      try {
        const res = await fetch(BACKEND + "/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ mode, text })
        });

        const data = await res.json();

        // borrar el "Buscando..."
        chat.lastChild.remove();

        if (!res.ok || data.ok === false) {
          addMessage("‚ùå Error: " + (data.error || "Error desconocido"));
          return;
        }

        addMessage(data.answer || "Sin respuesta");
      } catch (err) {
        chat.lastChild.remove();
        addMessage("‚ùå Error de conexi√≥n con el backend");
      }
    });
  </script>

</body>
</html>


